<html>

<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>
    docker 部署PHP网页 | EdenBlog
</title>
<link rel="shortcut icon" href="https://zhuoquany.github.io/favicon.ico?v=1582599387447">
<!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"> -->
<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://zhuoquany.github.io/styles/main.css">
<!-- js -->
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="https://zhuoquany.github.io/media/js/jquery.sticky-sidebar.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>


	
	<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?77bd6397391215a549b975dd2453838a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

        
</head>

<body>
    <div class="main">
        <div class="header">
    <div class="nav">
        <div class="logo">
            <a href="https://zhuoquany.github.io">
                <img class="avatar" src="https://zhuoquany.github.io/images/avatar.png?v=1582599387447" alt="">
            </a>
            <div class="site-title">
                <h1>
                    EdenBlog
                </h1>
            </div>
        </div>
        <span class="menu-btn fa fa-align-justify"></span>
        <div class="menu-container">
            <ul>
                
                    
                            <li>
                                <a href="/" class="menu">
                                    首页
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/archives" class="menu">
                                    归档
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/tags" class="menu">
                                    标签
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/post/about" class="menu">
                                    关于
                                </a>
                            </li>
                            
                                
            </ul>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        $(".menu-btn").click(function() {
            $(".menu-container").slideToggle();
        });
        $(window).resize(function() {

            if (window.matchMedia('(min-width: 960px)').matches) {
                $(".menu-container").css('display', 'block')
            } else {
                $(".menu-container").css('display', 'none')
            }

        });
    });
</script>

            <div id="main-content" class="post-detail main-container">
                <!-- left -->
                <div id="content" class="main-container-left">
                    <article class="post i-card">
                        <h2 class="post-title">
                            docker 部署PHP网页
                        </h2>
                        <div class="post-info">
                            <time class="post-time">2020-02-25</time>
                            
                                <a href="https://zhuoquany.github.io/tag/Sn6c33z7i/" class="post-tag i-tag
                            i-tag-other_2">
                            #docker
                        </a>
                                
                                <a href="https://zhuoquany.github.io/tag/ldOdQMARAK/" class="post-tag i-tag
                            i-tag-">
                            #PHP
                        </a>
                                
                        </div>
                        
                                <div class="post-content">
                                    <h2 id="docker-部署php网页">docker 部署PHP网页</h2>
<p>准备好两个镜像</p>
<!-- more -->
<p><img src="https://zhuoquany.github.io/post-images/1582597946531.png" alt="" loading="lazy"><br>
然后创建两个容器:</p>
<pre><code class="language-bash">docker  run --name=&quot;apachedemo&quot;  -p 80:80   -d  nimmis/apache-php5

docker run --name mysqldemo -p 3306:3306 -e MYSQL_ROOT_PASSWORD=password -d mysql/mysql-server:latest
</code></pre>
<p>docker ps 查看两个容器的状态，如果docker ps 没有说明容器没有起来。</p>
<p>docker ps 默认查看的是正在运行的容器。<br>
<img src="https://zhuoquany.github.io/post-images/1582597959191.png" alt="" loading="lazy"></p>
<p>然后在游览器输入docker 宿主机的ip；docker  安装环境的ip；</p>
<p>（比如：虚拟机里面安装Linux，Linux里面安装docker ，你要访问网页应该输入Linux的ip）；</p>
<p>出现如下界面，则表示Apache服务安装没有问题。<br>
<img src="https://zhuoquany.github.io/post-images/1582597969085.png" alt="" loading="lazy"></p>
<p>​    在Linux上新建一个PHP 文件，这里我命名为 demo.php</p>
<p>输入一下内容。</p>
<p>ip地址根据自己的ip修改。</p>
<pre><code class="language-php">&lt;?php
header(&quot;Content-Type: text/html;charset=utf-8&quot;);
echo &quot;&lt;h1&gt;Results  from database&lt;/h1&gt;&quot;;
$servername = &quot;192.168.43.227&quot;;
$username = &quot;root&quot;;
$password = &quot;password&quot;;
$dbname = &quot;book&quot;;
 
$conn = mysqli_connect('192.168.10.9','root','root') or die(&quot;error:&quot; .mysqli_connect_error());
mysqli_select_db($conn,'book');
 
$sql = &quot;SELECT *  FROM student&quot;;
$result = mysqli_query($conn,$sql);
    while($row = mysqli_fetch_array($result)) {
        echo &quot;&lt;h2&gt;&quot;;
	echo $row['name']. &quot;&lt;br/&gt;&quot;;
	echo &quot;&lt;/h2&gt;&quot;;
    }
?&gt;
</code></pre>
<p>第一次访问可能会出现一下的错误：</p>
<p>这是因为mysql 没有开启远程登录权限。</p>
<p>我们进入mysql容器修改相应的权限。<br>
<img src="https://zhuoquany.github.io/post-images/1582597987851.png" alt="" loading="lazy"></p>
<pre><code class="language-bash">docker exec -it 1ed50ef86354  /bin/bash
</code></pre>
<p>docker exec -it  加容器ID或者容器名字可以进入docker容器内。</p>
<p>exit 退出容器。</p>
<p>mysql -uroot  -ppassword 登录mysql</p>
<pre><code class="language-mysql">use mysql;
SELECT User, Host FROM user;
update user set host = '%' where user = 'root';
 flush privileges;
</code></pre>
<p>顺便再创建一个表</p>
<pre><code class="language-mysql">create   database  book;

use book;

create  table  student (id int ,name varchar(20));

insert into student values(1,'Joy'),(2,'Tom'),(3,'James');
</code></pre>
<p>再次访问会出现如下错误:</p>
<p>Server sent charset unknown to the client. Please, report to the developers</p>
<p>这是因为mysql最新版的字符默认字符编码 utf8mb4，所以我们要设置MySQL的默认字符集为老版本的utf8<br>
<img src="https://zhuoquany.github.io/post-images/1582598002887.png" alt="" loading="lazy"></p>
<p>还是在mysql容器内执行</p>
<p>mysql  --help | grep my.cnf</p>
<p><img src="https://zhuoquany.github.io/post-images/1582598035668.png" alt="" loading="lazy"><br>
查看mysql配置文件的路径那。</p>
<p>我安装的mysql-service精简到了连vi和vim也没有，所以需要自己手动安装。用yum安装就好了。由于没有配置yum源所以会很慢。</p>
<p>修改/etc/my.cnf</p>
<pre><code>[client]
default-character-set=utf8

[mysql]
default-character-set=utf8

[mysqld]
collation-server = utf8_unicode_ci
character-set-server = utf8
default_authentication_plugin=mysql_native_password
</code></pre>
<p>修改配置文件后重启一下mysql 服务。</p>
<p>退出到Linux  系统，执行docker  restart mysqldemo</p>
<p>再次进入游览器，报错 The server requested authentication method unknown to the client。</p>
<p>是由于用户身份认证的加密方式不兼容导致的，<code>mysql8.0</code>中默认方式为<code>caching_sha2_password</code>，引起老版本兼容性问题，老版本加密方式为<code>mysql_native_password</code>。<br>
<img src="https://zhuoquany.github.io/post-images/1582598046444.png" alt="" loading="lazy"></p>
<pre><code class="language-bash">mysql -uroot -p
 
use mysql;
ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '你的密码';
</code></pre>
<p>我们这里修改为</p>
<p>ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY 'password';</p>
<p>然后再次访问：<br>
<img src="https://zhuoquany.github.io/post-images/1582598055802.png" alt="" loading="lazy"></p>

                                </div>
                    </article>
                    <!--  -->
                    
                        <div class="next-post">
                            <div class="next">下一篇</div>
                            <a href="https://zhuoquany.github.io/post/apm-geng-huan-wei-guo-nei-yuan/">
                                <h3 class="post-title">
                                    apm 更换为国内源
                                </h3>
                            </a>
                        </div>
                        
                            <div id="disqus_thread"></div>
                            <div id="gitalk-container"></div>
                </div>
                <!-- middle -->
                <div class="main-container-middle"></div>
                <!-- right -->
                <div id="sidebar" class="main-container-right">
                    
                        <!-- toc -->
                        
    <div class="toc-card i-card ">
        <div class="toc-title i-card-title">目录</div>
        <div class="toc-content">
            <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#docker-%E9%83%A8%E7%BD%B2php%E7%BD%91%E9%A1%B5">docker 部署PHP网页</a></li>
</ul>
</li>
</ul>

        </div>
        <script>
            function locateCatelogList() {
                /*获取文章目录集合,可通过:header过滤器*/
                var alis = $('.post-content :header');
                /*获取侧边栏目录列表集合**/
                var sidebar_alis = $('.markdownIt-TOC a');
                /*获取滚动条到顶部的距离*/
                var scroll_height = $(window).scrollTop();
                for (var i = 0; i < alis.length; i++) {
                    /*获取锚点集合中的元素分别到顶点的距离*/
                    var a_height = $(alis[i]).offset().top;
                    if (a_height < scroll_height) {
                        /*高亮显示*/
                        sidebar_alis.removeClass('on');
                        $(sidebar_alis[i]).addClass('on');
                    }
                }
            }
            $(function() {
                /*绑定滚动事件 */
                $(window).bind('scroll', locateCatelogList);
            });
        </script>
    </div>
    
                            

                </div>




            </div>


            <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | 
  <a class="rss" href="https://zhuoquany.github.io/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>


    </div>
    <script>
        $('#sidebar').stickySidebar({
            topSpacing: 80,
            // bottomSpacing: 60
        });
    </script>
    
</body>

</html>